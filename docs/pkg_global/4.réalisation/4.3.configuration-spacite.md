---
chapitre: true
package: pkg_global
order: 43
---

## Packages de gestion des rôles et permissions

### **2. Packages de gestion des rôles et permissions**

#### **2.1. Spatie Laravel Permission**
- **Description** : Gestion des rôles et des permissions pour les utilisateurs.  
- **Installation** :
  ```bash
  composer require spatie/laravel-permission
  ```
- **Configuration** :
  - Publiez les fichiers de configuration :
    ```bash
    php artisan vendor:publish --provider="Spatie\Permission\PermissionServiceProvider"
    ```
  - Exécutez les migrations :
    ```bash
    php artisan migrate
    ```

Voici les noms et descriptions des tables créées :  

1. **permissions** : Gère les permissions disponibles dans le système.  
2. **roles** : Contient les rôles définis pour les utilisateurs.  
3. **model_has_permissions** : Associe des permissions spécifiques à des modèles (ex. utilisateurs).  
4. **model_has_roles** : Associe des rôles spécifiques à des modèles (ex. utilisateurs).  
5. **role_has_permissions** : Relie les rôles aux permissions associées.  



### Configuration de Model User 


- Déclaration des rôle commes des constante dans le Model User
- Ajout de trait : HasRoles

````php
class User extends Authenticatable
{
    use HasFactory, Notifiable, HasRoles;

    public const ADMIN = "admin";
    public const MEMBRE = "membre";
    
````


### Ajouter UserSeeder dans /database/seeders


````php
<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\User;
use Illuminate\Support\Facades\Hash;

class UserSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        $users = [
            [
                'name' => 'membre',
                'email' => 'membre@solicode.co',
                'password' => 'membre',
                'role' => User::MEMBRE,
            ],
            [
                'name' => 'admin',
                'email' => 'admin@solicode.co',
                'password' => 'admin',
                'role' => User::ADMIN,
            ],
        ];

        foreach ($users as $user) {
            User::create([
                'name' => $user['name'],
                'email' => $user['email'],
                'password' => Hash::make($user['password']),
            ])->assignRole($user['role']);
        }
    }
}

````

La méthode `assignRole` de Laravel, via le package Spatie, attribue un ou plusieurs rôles à un modèle, souvent un utilisateur. Elle prend en paramètre des noms de rôles ou des instances de modèles de rôle et enregistre la relation dans la table pivot `model_has_roles`. Si le modèle utilise des équipes, la clé étrangère de l'équipe est aussi ajoutée.

Ajouter de fichier RoleSeeder

````php
namespace Database\Seeders;

use App\Models\User;
use Illuminate\Database\Seeder;
use Spatie\Permission\Models\Role;

class RoleSeeder extends Seeder
{
    public function run(): void
    {
        Role::create(['name' => User::ADMIN]);
        Role::create(['name' => User::MEMBRE]);
    }
}

````

Dans DatabaseSeeder

````php
namespace Database\Seeders;
use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        $this->call(UserSeeder::class);
        $this->call(RoleSeeder::class);
    }
}
````


Maintenant vous pouvez Teste l'authentification avec 

Login : admin@solicode.co
Password : admin